scene:
    background:
        color: '#8db7d5'
cameras:
    iso-camera:
        # Manhattan
        position: [-74.00976419448854, 40.70532700869127, 16]
        type: isometric
        axis: [0, 1]
        active: false
    perspective-camera:
        # Manhattan
        position: [-74.00976419448854, 40.70532700869127, 16]
        type: perspective #currently ignored
        focal_length: [[16, 2], [20, 6]] # currently ignored
        vanishing_point: [-250, -250] # currently ignored
        active: true

lights:
    light1:
        type: directional
        origin: world
        direction: [1, 1, -1]
        diffuse: [.3, .3, .3, 1.]
        ambient: [0.7, 0.7, 0.7, 1.]

textures:
    pois:
        url: img/poi_icons_32.png
        sprites:
            plane: [0, 0, 32, 32]
            tree: [0, 185, 32, 32]
            sunburst: [0, 629, 32, 32]
            restaurant: [0, 777, 32, 32]
            cafe: [0, 814, 32, 32]
            museum: [0, 518, 32, 32]
            bar: [0, 887, 32, 32]
            train: [0, 74, 32, 32]
            bus: [0, 148, 32, 32]
            hospital: [0, 444, 32, 32]
            parking: [0, 1073, 32, 32]
            info: [0, 1110, 32, 32]
            hotel: [0, 259, 32, 32]
            bookstore: [0, 333, 32, 32]

styles:
    flatcolor:
        base: polygons
        lighting: false
    heightglow:
        base: polygons
        lighting: vertex
        shaders:
            blocks:
                color: "color.rgb += vec3(position.z / 800.);"
    heightglowline:
        base: lines
        mix: heightglow
    icons:
        base: points
        texture: pois

sources:
    osm:
        type: MVT
        url:  https://vector.mapzen.com/osm/all/{z}/{x}/{y}.mvt

layers:
    touch:
        data: { source: touch }
        line:
          filter: { type: line }
          draw:
            lines:
              color: function () { return feature.color || 'black'; }
              order: 50
              width: 2px
        poly:
            filter: { type: poly }
            draw:
              polygons:
                color: magenta
                order: 40
        point:
            filter: { type: point }
            draw:
              icons:
                sprite: sunburst
                collide: false
                transition:
                    [show, hide]:
                        time: 0s

    earth:
        data: { source: osm }
        draw:
            polygons:
                order: 0
                color: '#f0ebeb'

    landuse:
        data: { source: osm }
        draw:
            polygons:
                order: 1
                color: '#fffffa'
                interactive: true # currently ignored
        green:
            filter: { kind: [park, graveyard, cemetery, forest, recreation_ground] }
            draw:
                polygons:
                    order: 2
                    color: '#89ab84'
        blue:
            filter: { kind: [commercial, industrial] }
            draw:
                polygons:
                    color: '#C0CDCD'
        orange:
            filter: { kind: [university] }
            draw:
                polygons:
                    color: '#D9CFC3'

    water:
        data: { source: osm }
        filter:
            any:
                # show smaller water areas at higher zooms
                - { $zoom: { min: 0 }, area: { min: 10000000 } }
                - { $zoom: { min: 10 }, area: { min: 1000000 } }
                - { $zoom: { min: 12 }, area: { min: 100000 } }
                - { $zoom: { min: 15 }, area: { min: 1000 } }
                - { $zoom: { min: 18 } }
        draw:
            flatcolor:
                order: 3
                color: '#8db7d5'
    buildings:
        data: { source: osm }
        filter: { $zoom: { min: 14 } }
        draw:
            polygons:
                style: heightglow
                order: 50
                color: [.65, .65, .63]
        # turn interactive feature selection on for buildings with names
        interactive:
            filter: { name: true }
            draw:
                polygons:
                    interactive: true
        extruded:
            filter: { $zoom: { min: 15 } }
            draw:
                polygons:
                    extrude: true

    road_labels:
        data: {source: osm, layer: roads}
        filter: { name: true, aeroway: false, tunnel: false, railway: false, not: { kind: rail }, $zoom: { min: 10 } }
        draw:
            text:
                interactive: true
                visible: true
                priority: 2
                transition:
                    [show, hide]:
                        time: 1s
                offset: [[16, [0, 8px]], [18, [0, 120px]]]
                font:
                    family: sans-serif
                    weight: 400
                    style: normal
                    size: 1.em
                    fill: black
                    stroke: { color: white, width: 2 }

