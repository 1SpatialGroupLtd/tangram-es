Developing the Tangram iOS SDK
==============================

This page is for those who intend to modify Tangram ES itself, not just use it in another application.

## Don't commit code signing changes ##

When building and running the demo application on an iOS device, you will likely need to modify the "App ID" and "Development Team" values in the Xcode project in order to sign the application package correctly because Apple mandates that an App ID can only be used by one Development Team. This is a good security practice, but since the App ID and Developer Team values are embedded in the Xcode project data, there is no way for each developer working with the repository to use their App ID / Developer Team values without modifying the Xcode project files that are checked into source control.

This can be disruptive to a git workflow because git will show the Xcode project file as modified. To work with a clean source tree, you can stash your changes to the demo Xcode project before committing changes, then restore those changes from the stash when you want to run the demo again:
```
# Stash changes to demo project
git stash push -m "Xcode signing info" platforms/ios/demo/TangramDemo.xcodeproj/project.pbxproj
# Use git as normal
git stash apply
# Run demo project again
```

## Always run builds from the Xcode workspace ##

The Xcode workspace that contains both the demo app project and the framework project uses specific build location settings to ensure that build products for both the framework and demo app are placed in the right locations and are able to build together successfully. If you try to open the demo project separately and build it, the build will probably fail or link against a "stale" version of the framework.

### Background on the Xcode workspace setup ###

We use an Xcode workspace to group the framework and demo projects together so that the framework can be built and debugged along with the demo app as a dependency. The framework project is most convenient to generate through CMake, since it is comprised mostly of the cross-platform C++ core library and its dependencies. The demo app project could also be generated through CMake, but configuring an iOS application with an embedded, code-signed binary framework is complex and fragile with CMake. Furthermore, unlike the core library the demo app has no need for a platform-agnostic build configuration. Therefore it is simplest to use a "hand made" Xcode project to build the demo app. The Xcode workspace allows the demo project to reference the CMake-generated framework project as a dependency. This makes running and debugging both projects together very easy!

Building a project through an Xcode workspace behaves a little differently from building the project on its own (see [Apple's documentation](https://developer.apple.com/library/archive/featuredarticles/XcodeConcepts/Concept-Workspace.html#//apple_ref/doc/uid/TP40009328-CH7-SW1) for a thorough explanation). By default, a workspace overrides the build output locations of the individual projects in it, placing the output for all projects into a separate, shared build folder instead. This causes build errors for projects generated by CMake. CMake hard-codes the absolute paths of build products like library dependencies into the Xcode project. Link flags in the project have those same paths hard-coded as well, so if build outputs are relocated by an Xcode workspace the link commands will fail to find the libraries at the paths in the project.

To overcome this, we use a workspace setting that keeps build products in the locations specified by their original projects. This can be set in Xcode by opening a workspace, then navigating to _File_ > _Workspace Settings_ in the menu bar, then clicking _Advanced..._, then choosing the _Legacy_ option.

This setting is stored per-user in the workspace data, located in `Tangram.xcworkspace/xcuserdata/$USER.xcuserdatad/WorkspaceSettings.xcsettings` where `$USER` is the current user name. Since this path is different for every user, we cannot track this file in git. Instead, we keep a file that stores these settings in `platforms/ios/WorkspaceSettings.xcsettings` and we copy this file into the appropriate location for each user as a step in the `make cmake-ios` rule in our `Makefile`.
